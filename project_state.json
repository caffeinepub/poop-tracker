{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 23,
  "summary": "Poop tracker app - A playful group tracker where friends log poops and wipes with leaderboards and daily progress views",
  "architectural_notes": [
    "Use Internet Identity for simple passkey-based authentication",
    "Store poop entries with automatic timestamp (date and time)",
    "Calculate TP rolls from wipes using sheets-per-wipe and sheets-per-roll constants",
    "Profile linked to each logged entry to ensure proper data attribution",
    "Daily leaderboard stats reset at midnight in each user's local timezone",
    "All entries stored with dates and timestamps to enable future historical features",
    "The Efficient Wiper badge is standalone and awarded to the user with the lowest average wipes per poop; no minimum poop requirement; MVP title remains tied only to King Pooper + King Wiper"
  ],
  "known_issues": [
    "Profile creation screen blocks access to main page after login even when an existing profile is present — profile lookup fails to retrieve existing profile and falls through to creation flow",
    "Version 9 profile loading fix caused app to get stuck on loading screen indefinitely; rolled back to pre-Efficient Wiper version",
    "Version 10 still redirects to profile creation screen on startup even when user already has a profile — app gets stuck on profile creation; profile lookup resolves to 'no profile' before backend call completes"
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-implement-internet-identity-authentication-so-users-can-securely-log-in-and-have-their-poop-and-wipe-entries-tracked-to-their-individual-profiles",
      "title": "Implement Internet Identity authentication so users can securely log in and have their poop and wipe entries tracked to their individual profiles",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-create-user-profiles-where-each-user-can-set-a-custom-display-name-choose-from-preset-emojis-icons-and-select-colors-and-backgrounds-for-their-profile-appearance",
      "title": "Create user profiles where each user can set a custom display name, choose from preset emojis/icons, and select colors and backgrounds for their profile appearance",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-simple-data-entry-flow-where-logged-in-users-tap-to-log-a-poop-enter-the-number-of-wipes-and-the-entry-is-automatically-timestamped-with-the-current-date-and-time",
      "title": "Build a simple data entry flow where logged-in users tap to log a poop, enter the number of wipes, and the entry is automatically timestamped with the current date and time",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-lifetime-leaderboard-that-displays-rankings-for-most-poops-king-pooper-most-wipes-king-wiper-and-awards-a-special-mvp-most-valuable-pooper-badge-to-anyone-who-holds-both-titles",
      "title": "Create a lifetime leaderboard that displays rankings for most poops (King Pooper), most wipes (King Wiper), and awards a special MVP: Most Valuable Pooper badge to anyone who holds both titles",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-daily-view-that-shows-everyone-s-progress-for-the-current-day-with-a-toggle-to-switch-between-group-view-all-users-and-individual-view-single-user-s-stats",
      "title": "Build a daily view that shows everyone's progress for the current day, with a toggle to switch between group view (all users) and individual view (single user's stats)",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-design-a-playful-and-humorous-visual-theme-for-the-app-with-fun-colors-typography-and-layout-that-matches-the-lighthearted-nature-of-tracking-poops-and-wipes-among-friends-ensuring-the-ui-feels-joking-but-still-functional-and-easy-to-use",
      "title": "Design a playful and humorous visual theme for the app with fun colors, typography, and layout that matches the lighthearted nature of tracking poops and wipes among friends, ensuring the UI feels joking but still functional and easy to use",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-the-existing-leaderboard-placeholder-component-and-replace-it-with-a-fully-functional-lifetime-leaderboard-that-displays-king-pooper-user-with-most-total-poops-king-wiper-user-with-most-total-wipes-and-mvp-most-valuable-pooper-badge-for-any-user-who-holds-both-titles-simultaneously",
      "title": "Remove the existing leaderboard placeholder component and replace it with a fully functional lifetime leaderboard that displays King Pooper (user with most total poops), King Wiper (user with most total wipes), and MVP: Most Valuable Pooper badge for any user who holds both titles simultaneously",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-calculate-and-display-toilet-paper-roll-consumption-for-each-user-based-on-lifetime-wipes-using-the-formula-total-wipes-sheets-per-wipe-sheets-per-roll-showing-the-result-as-a-fun-statistic-on-the-leaderboard",
      "title": "Calculate and display toilet paper roll consumption for each user based on lifetime wipes using the formula: (total wipes × sheets per wipe) ÷ sheets per roll, showing the result as a fun statistic on the leaderboard",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-calculate-and-display-average-wipes-per-poop-for-each-user-using-the-formula-total-wipes-total-poops-showing-this-efficiency-metric-in-the-leaderboard-standings-table",
      "title": "Calculate and display average wipes per poop for each user using the formula: total wipes ÷ total poops, showing this efficiency metric in the leaderboard standings table",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-create-an-all-time-standings-table-that-displays-all-users-ranked-primarily-by-total-poops-and-secondarily-by-total-wipes-showing-columns-for-display-name-emoji-total-poops-total-wipes-toilet-paper-rolls-used-and-average-wipes-per-poop-for-each-person",
      "title": "Create an all-time standings table that displays all users ranked primarily by total poops and secondarily by total wipes, showing columns for display name/emoji, total poops, total wipes, toilet paper rolls used, and average wipes per poop for each person",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-emoji-alignment-in-the-profile-creation-page-so-that-emojis-are-properly-centered-within-their-selection-boxes-in-mobile-view",
      "title": "Fix emoji alignment in the profile creation page so that emojis are properly centered within their selection boxes in mobile view",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-toggle-switch-component-to-the-leaderboard-page-that-allows-users-to-switch-between-lifetime-and-daily-view-modes",
      "title": "Add a toggle switch component to the leaderboard page that allows users to switch between 'Lifetime' and 'Daily' view modes",
      "reqIds": [
        "REQ-15"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-leaderboard-component-to-display-daily-king-pooper-king-wiper-and-mvp-badge-based-on-daily-statistics-when-toggle-is-set-to-daily-mode",
      "title": "Update the Leaderboard component to display daily King Pooper, King Wiper, and MVP badge based on daily statistics when toggle is set to 'Daily' mode",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-alltimestandings-component-to-display-daily-standings-table-when-toggle-is-set-to-daily-mode-showing-all-users-ranked-by-today-s-poops-and-wipes-with-columns-for-total-poops-total-wipes-toilet-paper-rolls-used-and-average-wipes-per-poop",
      "title": "Update the AllTimeStandings component to display daily standings table when toggle is set to 'Daily' mode, showing all users ranked by today's poops and wipes with columns for total poops, total wipes, toilet paper rolls used, and average wipes per poop",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-add-the-efficient-wiper-title-badge-to-the-leaderboard-component-in-both-lifetime-and-daily-view-modes-awarded-to-the-user-with-the-lowest-average-wipes-per-poop-displayed-in-the-top-badges-section-with-the-same-format-as-king-pooper-and-king-wiper",
      "title": "Add 'The Efficient Wiper' title badge to the Leaderboard component in both Lifetime and Daily view modes, awarded to the user with the lowest average wipes per poop, displayed in the top badges section with the same format as King Pooper and King Wiper",
      "reqIds": [
        "REQ-21"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-alltimestandings-component-to-visually-highlight-or-indicate-which-user-is-the-efficient-wiper-in-both-lifetime-and-daily-standings-tables",
      "title": "Update the AllTimeStandings component to visually highlight or indicate which user is The Efficient Wiper in both Lifetime and Daily standings tables",
      "reqIds": [
        "REQ-22"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-efficient-wiper-badge-logic-in-the-leaderboard-component-so-it-selects-the-user-with-the-lowest-average-wipes-per-poop-not-the-highest-the-badge-must-apply-in-both-lifetime-and-daily-view-modes-no-minimum-poop-count-is-required-to-qualify",
      "title": "Fix the Efficient Wiper badge logic in the Leaderboard component so it selects the user with the lowest average wipes per poop (not the highest). The badge must apply in both Lifetime and Daily view modes. No minimum poop count is required to qualify.",
      "reqIds": [
        "REQ-23"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-profile-lookup-logic-in-app-tsx-so-that-after-a-user-authenticates-with-internet-identity-the-app-correctly-fetches-and-recognizes-their-existing-profile-before-deciding-whether-to-show-profilesetup-or-the-main-dashboard-if-a-profile-already-exists-for-the-authenticated-principal-skip-profilesetup-entirely-and-navigate-directly-to-the-dashboard",
      "title": "Fix the profile lookup logic in App.tsx so that after a user authenticates with Internet Identity, the app correctly fetches and recognizes their existing profile before deciding whether to show ProfileSetup or the main Dashboard. If a profile already exists for the authenticated principal, skip ProfileSetup entirely and navigate directly to the Dashboard.",
      "reqIds": [
        "REQ-24"
      ],
      "version": 1
    },
    {
      "id": "feature-audit-the-usequeries-ts-profile-fetching-hook-to-ensure-it-does-not-return-a-no-profile-result-prematurely-e-g-before-the-actor-is-ready-or-before-the-async-call-completes-which-would-incorrectly-trigger-the-profile-creation-flow-for-existing-users",
      "title": "Audit the useQueries.ts profile-fetching hook to ensure it does not return a 'no profile' result prematurely (e.g., before the actor is ready or before the async call completes), which would incorrectly trigger the profile creation flow for existing users.",
      "reqIds": [
        "REQ-25"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-the-profile-detection-and-routing-logic-in-app-tsx-from-scratch-the-app-must-not-render-profilesetup-or-make-any-routing-decision-until-both-the-actor-is-fully-initialized-and-the-profile-query-has-completed-i-e-is-no-longer-in-a-loading-pending-state-introduce-an-explicit-tri-state-loading-actor-not-ready-or-query-in-flight-has-profile-query-resolved-with-a-profile-no-profile-query-resolved-with-null-empty-only-navigate-to-profilesetup-when-state-is-definitively-no-profile-show-a-full-screen-loading-indicator-during-the-loading-state",
      "title": "Rewrite the profile detection and routing logic in App.tsx from scratch. The app must not render ProfileSetup or make any routing decision until BOTH the actor is fully initialized AND the profile query has completed (i.e., is no longer in a loading/pending state). Introduce an explicit tri-state: 'loading' (actor not ready OR query in flight), 'has-profile' (query resolved with a profile), 'no-profile' (query resolved with null/empty). Only navigate to ProfileSetup when state is definitively 'no-profile'. Show a full-screen loading indicator during the 'loading' state.",
      "reqIds": [
        "REQ-26"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-the-useprofile-hook-in-usequeries-ts-to-guarantee-it-never-returns-a-no-profile-result-prematurely-the-hook-must-1-remain-in-a-loading-pending-state-while-the-actor-is-not-yet-initialized-2-only-resolve-to-a-no-profile-result-after-the-async-backend-call-has-fully-completed-and-returned-a-definitive-empty-null-response-and-3-never-fire-the-backend-query-if-the-actor-is-undefined-or-not-ready",
      "title": "Rewrite the useProfile hook in useQueries.ts to guarantee it never returns a 'no profile' result prematurely. The hook must: (1) remain in a loading/pending state while the actor is not yet initialized, (2) only resolve to a 'no profile' result after the async backend call has fully completed and returned a definitive empty/null response, and (3) never fire the backend query if the actor is undefined or not ready.",
      "reqIds": [
        "REQ-27"
      ],
      "version": 1
    },
    {
      "id": "feature-revert-app-tsx-to-the-working-version-that-existed-before-the-efficient-wiper-badge-features-and-the-subsequent-profile-loading-fixes-were-introduced-the-reverted-app-tsx-must-use-simple-direct-profile-detection-and-routing-logic-not-the-tri-state-loading-system-that-was-in-place-when-the-app-was-last-confirmed-working-remove-the-tri-state-loading-has-profile-no-profile-pattern-that-caused-the-app-to-get-stuck-on-the-loading-screen-indefinitely",
      "title": "Revert App.tsx to the working version that existed before the Efficient Wiper badge features and the subsequent profile loading fixes were introduced. The reverted App.tsx must use simple, direct profile detection and routing logic — not the tri-state loading system — that was in place when the app was last confirmed working. Remove the tri-state ('loading'/'has-profile'/'no-profile') pattern that caused the app to get stuck on the loading screen indefinitely.",
      "reqIds": [
        "REQ-28"
      ],
      "version": 1
    },
    {
      "id": "feature-revert-usequeries-ts-to-the-working-version-that-existed-before-the-efficient-wiper-badge-features-and-profile-loading-fixes-were-introduced-remove-the-guarded-useprofile-hook-rewrite-that-was-added-in-the-problematic-versions-restoring-the-original-profile-fetching-logic-that-worked-correctly-prior-to-those-changes",
      "title": "Revert useQueries.ts to the working version that existed before the Efficient Wiper badge features and profile loading fixes were introduced. Remove the guarded useProfile hook rewrite that was added in the problematic versions, restoring the original profile-fetching logic that worked correctly prior to those changes.",
      "reqIds": [
        "REQ-29"
      ],
      "version": 1
    },
    {
      "id": "feature-revert-the-leaderboard-tsx-component-to-the-working-version-before-the-efficient-wiper-badge-was-added-remove-the-efficient-wiper-award-category-from-the-top-badges-section-restoring-only-king-pooper-king-wiper-and-the-mvp-badge-the-lifetime-daily-toggle-must-remain-intact",
      "title": "Revert the Leaderboard.tsx component to the working version before the Efficient Wiper badge was added. Remove The Efficient Wiper award category from the top badges section, restoring only King Pooper, King Wiper, and the MVP badge. The lifetime/daily toggle must remain intact.",
      "reqIds": [
        "REQ-30"
      ],
      "version": 1
    },
    {
      "id": "feature-revert-the-alltimestandings-tsx-component-to-the-working-version-before-the-efficient-wiper-highlighting-was-added-remove-any-visual-highlighting-or-indication-of-the-efficient-wiper-from-both-lifetime-and-daily-standings-tables-the-standings-table-must-still-show-columns-for-display-name-emoji-total-poops-total-wipes-toilet-paper-rolls-used-and-average-wipes-per-poop-and-must-still-respond-to-the-lifetime-daily-toggle",
      "title": "Revert the AllTimeStandings.tsx component to the working version before The Efficient Wiper highlighting was added. Remove any visual highlighting or indication of The Efficient Wiper from both lifetime and daily standings tables. The standings table must still show columns for display name/emoji, total poops, total wipes, toilet paper rolls used, and average wipes per poop, and must still respond to the lifetime/daily toggle.",
      "reqIds": [
        "REQ-31"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-the-useprofile-hook-in-usequeries-ts-using-a-manual-async-approach-use-a-plain-react-usestate-useeffect-or-usequery-with-enabled-guard-so-the-backend-getprofile-call-is-only-fired-after-the-actor-is-confirmed-non-null-the-hook-must-remain-in-a-loading-state-isloading-true-data-undefined-while-the-actor-is-undefined-or-null-and-only-transition-to-a-settled-state-isloading-false-after-the-async-call-has-fully-resolved-it-must-never-return-a-null-empty-profile-result-before-the-backend-call-has-actually-completed",
      "title": "Rewrite the useProfile hook in useQueries.ts using a manual async approach: use a plain React useState + useEffect (or useQuery with enabled guard) so the backend getProfile call is only fired after the actor is confirmed non-null. The hook must remain in a 'loading' state (isLoading: true, data: undefined) while the actor is undefined or null, and only transition to a settled state (isLoading: false) after the async call has fully resolved. It must never return a null/empty profile result before the backend call has actually completed.",
      "reqIds": [
        "REQ-32"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-the-routing-profile-detection-logic-in-app-tsx-using-a-simple-two-phase-approach-phase-1-show-a-full-screen-loading-spinner-while-the-actor-is-not-yet-initialized-or-while-the-profile-query-has-not-yet-settled-isloading-is-true-phase-2-once-the-query-has-settled-if-a-profile-exists-navigate-to-the-dashboard-if-no-profile-exists-navigate-to-profilesetup-do-not-use-a-tri-state-enum-pattern-do-not-make-any-routing-decision-render-profilesetup-or-dashboard-until-both-conditions-are-true-actor-is-non-null-and-isloading-is-false",
      "title": "Rewrite the routing/profile-detection logic in App.tsx using a simple two-phase approach: Phase 1 — show a full-screen loading spinner while the actor is not yet initialized OR while the profile query has not yet settled (isLoading is true). Phase 2 — once the query has settled, if a profile exists navigate to the Dashboard; if no profile exists navigate to ProfileSetup. Do NOT use a tri-state enum pattern. Do NOT make any routing decision (render ProfileSetup or Dashboard) until both conditions are true: actor is non-null AND isLoading is false.",
      "reqIds": [
        "REQ-33"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-safety-timeout-to-the-profile-loading-sequence-in-app-tsx-if-after-10-seconds-the-actor-is-still-not-initialized-or-the-profile-query-has-not-resolved-treat-the-state-as-no-profile-and-allow-the-user-to-proceed-to-profilesetup-rather-than-staying-stuck-indefinitely-display-a-user-friendly-message-in-the-loading-state-such-as-loading-your-profile",
      "title": "Add a safety timeout to the profile loading sequence in App.tsx: if after 10 seconds the actor is still not initialized or the profile query has not resolved, treat the state as 'no profile' and allow the user to proceed to ProfileSetup rather than staying stuck indefinitely. Display a user-friendly message in the loading state such as 'Loading your profile…'.",
      "reqIds": [
        "REQ-34"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "User authentication with Internet Identity for profile tracking",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "User profiles with customizable name, emoji/icon, colors, and backgrounds (no custom images)",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-3",
      "summary": "Simple data entry flow: log poop → enter wipes → auto-timestamp → done",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Daily view showing everyone's progress with toggle between group and individual views",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Add backend query function to aggregate and return all users' lifetime statistics including total poop count, total wipe count, and profile information needed for leaderboard rankings and standings table",
      "reqIds": [
        "REQ-13"
      ],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Add toggle switch to leaderboard page to switch between lifetime and daily views, with daily stats calculated from entries timestamped on the current day and resetting at midnight in each user's local timezone",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-14",
      "summary": "Add backend query function that calculates and returns daily statistics for all users based on entries from the current day, including total poops, total wipes, toilet paper rolls consumed, and average wipes per poop",
      "reqIds": [
        "REQ-16"
      ],
      "status": "pending"
    },
    {
      "id": "AR-17",
      "summary": "Ensure all poop entry timestamps are stored with full date and time information to enable daily statistics calculation and future historical feature development",
      "reqIds": [
        "REQ-19"
      ],
      "status": "pending"
    },
    {
      "id": "AR-18",
      "summary": "Implement daily statistics reset at midnight in each user's local timezone so that daily leaderboard competitions start fresh each day",
      "reqIds": [
        "REQ-20"
      ],
      "status": "pending"
    },
    {
      "id": "AR-19",
      "summary": "Add 'The Efficient Wiper' title to both lifetime and daily leaderboard views, awarded to the user with the lowest average wipes per poop, displayed as its own category in the top badges section alongside King Pooper and King Wiper",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Poop Tracker",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}