{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 25,
  "summary": "Poop tracker app - Simplified rebuild keeping Internet Identity login, user profiles (name + emoji), and a single unified dashboard with Lifetime/Daily toggle showing poop/wipe stats. Stripping back to core features only.",
  "architectural_notes": [
    "Use Internet Identity for simple passkey-based authentication",
    "Store poop entries with automatic timestamp (date and time)",
    "Calculate TP rolls from wipes using sheets-per-wipe and sheets-per-roll constants",
    "Profile linked to each logged entry to ensure proper data attribution",
    "Daily leaderboard stats reset at midnight in each user's local timezone",
    "All entries stored with dates and timestamps to enable future historical features",
    "App is being rebuilt from scratch — simplified codebase with no over-engineered profile detection or tri-state routing",
    "Single unified dashboard page with Lifetime/Daily toggle replacing separate leaderboard and daily view components"
  ],
  "known_issues": [],
  "isFixRequest": false,
  "existing_features": [
    {
      "id": "feature-implement-internet-identity-authentication-so-users-can-securely-log-in-and-have-their-poop-and-wipe-entries-tracked-to-their-individual-profiles",
      "title": "Implement Internet Identity authentication so users can securely log in and have their poop and wipe entries tracked to their individual profiles",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-create-user-profiles-where-each-user-can-set-a-custom-display-name-choose-from-preset-emojis-icons-and-select-colors-and-backgrounds-for-their-profile-appearance",
      "title": "Create user profiles where each user can set a custom display name, choose from preset emojis/icons, and select colors and backgrounds for their profile appearance",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-simple-data-entry-flow-where-logged-in-users-tap-to-log-a-poop-enter-the-number-of-wipes-and-the-entry-is-automatically-timestamped-with-the-current-date-and-time",
      "title": "Build a simple data entry flow where logged-in users tap to log a poop, enter the number of wipes, and the entry is automatically timestamped with the current date and time",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-create-a-lifetime-leaderboard-that-displays-rankings-for-most-poops-king-pooper-most-wipes-king-wiper-and-awards-a-special-mvp-most-valuable-pooper-badge-to-anyone-who-holds-both-titles",
      "title": "Create a lifetime leaderboard that displays rankings for most poops (King Pooper), most wipes (King Wiper), and awards a special MVP: Most Valuable Pooper badge to anyone who holds both titles",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-build-a-daily-view-that-shows-everyone-s-progress-for-the-current-day-with-a-toggle-to-switch-between-group-view-all-users-and-individual-view-single-user-s-stats",
      "title": "Build a daily view that shows everyone's progress for the current day, with a toggle to switch between group view (all users) and individual view (single user's stats)",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-design-a-playful-and-humorous-visual-theme-for-the-app-with-fun-colors-typography-and-layout-that-matches-the-lighthearted-nature-of-tracking-poops-and-wipes-among-friends-ensuring-the-ui-feels-joking-but-still-functional-and-easy-to-use",
      "title": "Design a playful and humorous visual theme for the app with fun colors, typography, and layout that matches the lighthearted nature of tracking poops and wipes among friends, ensuring the UI feels joking but still functional and easy to use",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-the-existing-leaderboard-placeholder-component-and-replace-it-with-a-fully-functional-lifetime-leaderboard-that-displays-king-pooper-user-with-most-total-poops-king-wiper-user-with-most-total-wipes-and-mvp-most-valuable-pooper-badge-for-any-user-who-holds-both-titles-simultaneously",
      "title": "Remove the existing leaderboard placeholder component and replace it with a fully functional lifetime leaderboard that displays King Pooper (user with most total poops), King Wiper (user with most total wipes), and MVP: Most Valuable Pooper badge for any user who holds both titles simultaneously",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-calculate-and-display-toilet-paper-roll-consumption-for-each-user-based-on-lifetime-wipes-using-the-formula-total-wipes-sheets-per-wipe-sheets-per-roll-showing-the-result-as-a-fun-statistic-on-the-leaderboard",
      "title": "Calculate and display toilet paper roll consumption for each user based on lifetime wipes using the formula: (total wipes × sheets per wipe) ÷ sheets per roll, showing the result as a fun statistic on the leaderboard",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-calculate-and-display-average-wipes-per-poop-for-each-user-using-the-formula-total-wipes-total-poops-showing-this-efficiency-metric-in-the-leaderboard-standings-table",
      "title": "Calculate and display average wipes per poop for each user using the formula: total wipes ÷ total poops, showing this efficiency metric in the leaderboard standings table",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-create-an-all-time-standings-table-that-displays-all-users-ranked-primarily-by-total-poops-and-secondarily-by-total-wipes-showing-columns-for-display-name-emoji-total-poops-total-wipes-toilet-paper-rolls-used-and-average-wipes-per-poop-for-each-person",
      "title": "Create an all-time standings table that displays all users ranked primarily by total poops and secondarily by total wipes, showing columns for display name/emoji, total poops, total wipes, toilet paper rolls used, and average wipes per poop for each person",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-emoji-alignment-in-the-profile-creation-page-so-that-emojis-are-properly-centered-within-their-selection-boxes-in-mobile-view",
      "title": "Fix emoji alignment in the profile creation page so that emojis are properly centered within their selection boxes in mobile view",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-toggle-switch-component-to-the-leaderboard-page-that-allows-users-to-switch-between-lifetime-and-daily-view-modes",
      "title": "Add a toggle switch component to the leaderboard page that allows users to switch between 'Lifetime' and 'Daily' view modes",
      "reqIds": [
        "REQ-15"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-leaderboard-component-to-display-daily-king-pooper-king-wiper-and-mvp-badge-based-on-daily-statistics-when-toggle-is-set-to-daily-mode",
      "title": "Update the Leaderboard component to display daily King Pooper, King Wiper, and MVP badge based on daily statistics when toggle is set to 'Daily' mode",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-alltimestandings-component-to-display-daily-standings-table-when-toggle-is-set-to-daily-mode-showing-all-users-ranked-by-today-s-poops-and-wipes-with-columns-for-total-poops-total-wipes-toilet-paper-rolls-used-and-average-wipes-per-poop",
      "title": "Update the AllTimeStandings component to display daily standings table when toggle is set to 'Daily' mode, showing all users ranked by today's poops and wipes with columns for total poops, total wipes, toilet paper rolls used, and average wipes per poop",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-add-the-efficient-wiper-title-badge-to-the-leaderboard-component-in-both-lifetime-and-daily-view-modes-awarded-to-the-user-with-the-lowest-average-wipes-per-poop-displayed-in-the-top-badges-section-with-the-same-format-as-king-pooper-and-king-wiper",
      "title": "Add 'The Efficient Wiper' title badge to the Leaderboard component in both Lifetime and Daily view modes, awarded to the user with the lowest average wipes per poop, displayed in the top badges section with the same format as King Pooper and King Wiper",
      "reqIds": [
        "REQ-21"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-alltimestandings-component-to-visually-highlight-or-indicate-which-user-is-the-efficient-wiper-in-both-lifetime-and-daily-standings-tables",
      "title": "Update the AllTimeStandings component to visually highlight or indicate which user is The Efficient Wiper in both Lifetime and Daily standings tables",
      "reqIds": [
        "REQ-22"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-efficient-wiper-badge-logic-in-the-leaderboard-component-so-it-selects-the-user-with-the-lowest-average-wipes-per-poop-not-the-highest-the-badge-must-apply-in-both-lifetime-and-daily-view-modes-no-minimum-poop-count-is-required-to-qualify",
      "title": "Fix the Efficient Wiper badge logic in the Leaderboard component so it selects the user with the lowest average wipes per poop (not the highest). The badge must apply in both Lifetime and Daily view modes. No minimum poop count is required to qualify.",
      "reqIds": [
        "REQ-23"
      ],
      "version": 1
    },
    {
      "id": "feature-fix-the-profile-lookup-logic-in-app-tsx-so-that-after-a-user-authenticates-with-internet-identity-the-app-correctly-fetches-and-recognizes-their-existing-profile-before-deciding-whether-to-show-profilesetup-or-the-main-dashboard-if-a-profile-already-exists-for-the-authenticated-principal-skip-profilesetup-entirely-and-navigate-directly-to-the-dashboard",
      "title": "Fix the profile lookup logic in App.tsx so that after a user authenticates with Internet Identity, the app correctly fetches and recognizes their existing profile before deciding whether to show ProfileSetup or the main Dashboard. If a profile already exists for the authenticated principal, skip ProfileSetup entirely and navigate directly to the Dashboard.",
      "reqIds": [
        "REQ-24"
      ],
      "version": 1
    },
    {
      "id": "feature-audit-the-usequeries-ts-profile-fetching-hook-to-ensure-it-does-not-return-a-no-profile-result-prematurely-e-g-before-the-actor-is-ready-or-before-the-async-call-completes-which-would-incorrectly-trigger-the-profile-creation-flow-for-existing-users",
      "title": "Audit the useQueries.ts profile-fetching hook to ensure it does not return a 'no profile' result prematurely (e.g., before the actor is ready or before the async call completes), which would incorrectly trigger the profile creation flow for existing users.",
      "reqIds": [
        "REQ-25"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-the-profile-detection-and-routing-logic-in-app-tsx-from-scratch-the-app-must-not-render-profilesetup-or-make-any-routing-decision-until-both-the-actor-is-fully-initialized-and-the-profile-query-has-completed-i-e-is-no-longer-in-a-loading-pending-state-introduce-an-explicit-tri-state-loading-actor-not-ready-or-query-in-flight-has-profile-query-resolved-with-a-profile-no-profile-query-resolved-with-null-empty-only-navigate-to-profilesetup-when-state-is-definitively-no-profile-show-a-full-screen-loading-indicator-during-the-loading-state",
      "title": "Rewrite the profile detection and routing logic in App.tsx from scratch. The app must not render ProfileSetup or make any routing decision until BOTH the actor is fully initialized AND the profile query has completed (i.e., is no longer in a loading/pending state). Introduce an explicit tri-state: 'loading' (actor not ready OR query in flight), 'has-profile' (query resolved with a profile), 'no-profile' (query resolved with null/empty). Only navigate to ProfileSetup when state is definitively 'no-profile'. Show a full-screen loading indicator during the 'loading' state.",
      "reqIds": [
        "REQ-26"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-the-useprofile-hook-in-usequeries-ts-to-guarantee-it-never-returns-a-no-profile-result-prematurely-the-hook-must-1-remain-in-a-loading-pending-state-while-the-actor-is-not-yet-initialized-2-only-resolve-to-a-no-profile-result-after-the-async-backend-call-has-fully-completed-and-returned-a-definitive-empty-null-response-and-3-never-fire-the-backend-query-if-the-actor-is-undefined-or-not-ready",
      "title": "Rewrite the useProfile hook in useQueries.ts to guarantee it never returns a 'no profile' result prematurely. The hook must: (1) remain in a loading/pending state while the actor is not yet initialized, (2) only resolve to a 'no profile' result after the async backend call has fully completed and returned a definitive empty/null response, and (3) never fire the backend query if the actor is undefined or not ready.",
      "reqIds": [
        "REQ-27"
      ],
      "version": 1
    },
    {
      "id": "feature-revert-app-tsx-to-the-working-version-that-existed-before-the-efficient-wiper-badge-features-and-the-subsequent-profile-loading-fixes-were-introduced-the-reverted-app-tsx-must-use-simple-direct-profile-detection-and-routing-logic-not-the-tri-state-loading-system-that-was-in-place-when-the-app-was-last-confirmed-working-remove-the-tri-state-loading-has-profile-no-profile-pattern-that-caused-the-app-to-get-stuck-on-the-loading-screen-indefinitely",
      "title": "Revert App.tsx to the working version that existed before the Efficient Wiper badge features and the subsequent profile loading fixes were introduced. The reverted App.tsx must use simple, direct profile detection and routing logic — not the tri-state loading system — that was in place when the app was last confirmed working. Remove the tri-state ('loading'/'has-profile'/'no-profile') pattern that caused the app to get stuck on the loading screen indefinitely.",
      "reqIds": [
        "REQ-28"
      ],
      "version": 1
    },
    {
      "id": "feature-revert-usequeries-ts-to-the-working-version-that-existed-before-the-efficient-wiper-badge-features-and-profile-loading-fixes-were-introduced-remove-the-guarded-useprofile-hook-rewrite-that-was-added-in-the-problematic-versions-restoring-the-original-profile-fetching-logic-that-worked-correctly-prior-to-those-changes",
      "title": "Revert useQueries.ts to the working version that existed before the Efficient Wiper badge features and profile loading fixes were introduced. Remove the guarded useProfile hook rewrite that was added in the problematic versions, restoring the original profile-fetching logic that worked correctly prior to those changes.",
      "reqIds": [
        "REQ-29"
      ],
      "version": 1
    },
    {
      "id": "feature-revert-the-leaderboard-tsx-component-to-the-working-version-before-the-efficient-wiper-badge-was-added-remove-the-efficient-wiper-award-category-from-the-top-badges-section-restoring-only-king-pooper-king-wiper-and-the-mvp-badge-the-lifetime-daily-toggle-must-remain-intact",
      "title": "Revert the Leaderboard.tsx component to the working version before the Efficient Wiper badge was added. Remove The Efficient Wiper award category from the top badges section, restoring only King Pooper, King Wiper, and the MVP badge. The lifetime/daily toggle must remain intact.",
      "reqIds": [
        "REQ-30"
      ],
      "version": 1
    },
    {
      "id": "feature-revert-the-alltimestandings-tsx-component-to-the-working-version-before-the-efficient-wiper-highlighting-was-added-remove-any-visual-highlighting-or-indication-of-the-efficient-wiper-from-both-lifetime-and-daily-standings-tables-the-standings-table-must-still-show-columns-for-display-name-emoji-total-poops-total-wipes-toilet-paper-rolls-used-and-average-wipes-per-poop-and-must-still-respond-to-the-lifetime-daily-toggle",
      "title": "Revert the AllTimeStandings.tsx component to the working version before The Efficient Wiper highlighting was added. Remove any visual highlighting or indication of The Efficient Wiper from both lifetime and daily standings tables. The standings table must still show columns for display name/emoji, total poops, total wipes, toilet paper rolls used, and average wipes per poop, and must still respond to the lifetime/daily toggle.",
      "reqIds": [
        "REQ-31"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-the-useprofile-hook-in-usequeries-ts-using-a-manual-async-approach-use-a-plain-react-usestate-useeffect-or-usequery-with-enabled-guard-so-the-backend-getprofile-call-is-only-fired-after-the-actor-is-confirmed-non-null-the-hook-must-remain-in-a-loading-state-isloading-true-data-undefined-while-the-actor-is-undefined-or-null-and-only-transition-to-a-settled-state-isloading-false-after-the-async-call-has-fully-resolved-it-must-never-return-a-null-empty-profile-result-before-the-backend-call-has-actually-completed",
      "title": "Rewrite the useProfile hook in useQueries.ts using a manual async approach: use a plain React useState + useEffect (or useQuery with enabled guard) so the backend getProfile call is only fired after the actor is confirmed non-null. The hook must remain in a 'loading' state (isLoading: true, data: undefined) while the actor is undefined or null, and only transition to a settled state (isLoading: false) after the async call has fully resolved. It must never return a null/empty profile result before the backend call has actually completed.",
      "reqIds": [
        "REQ-32"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-the-routing-profile-detection-logic-in-app-tsx-using-a-simple-two-phase-approach-phase-1-show-a-full-screen-loading-spinner-while-the-actor-is-not-yet-initialized-or-while-the-profile-query-has-not-yet-settled-isloading-is-true-phase-2-once-the-query-has-settled-if-a-profile-exists-navigate-to-the-dashboard-if-no-profile-exists-navigate-to-profilesetup-do-not-use-a-tri-state-enum-pattern-do-not-make-any-routing-decision-render-profilesetup-or-dashboard-until-both-conditions-are-true-actor-is-non-null-and-isloading-is-false",
      "title": "Rewrite the routing/profile-detection logic in App.tsx using a simple two-phase approach: Phase 1 — show a full-screen loading spinner while the actor is not yet initialized OR while the profile query has not yet settled (isLoading is true). Phase 2 — once the query has settled, if a profile exists navigate to the Dashboard; if no profile exists navigate to ProfileSetup. Do NOT use a tri-state enum pattern. Do NOT make any routing decision (render ProfileSetup or Dashboard) until both conditions are true: actor is non-null AND isLoading is false.",
      "reqIds": [
        "REQ-33"
      ],
      "version": 1
    },
    {
      "id": "feature-add-a-safety-timeout-to-the-profile-loading-sequence-in-app-tsx-if-after-10-seconds-the-actor-is-still-not-initialized-or-the-profile-query-has-not-resolved-treat-the-state-as-no-profile-and-allow-the-user-to-proceed-to-profilesetup-rather-than-staying-stuck-indefinitely-display-a-user-friendly-message-in-the-loading-state-such-as-loading-your-profile",
      "title": "Add a safety timeout to the profile loading sequence in App.tsx: if after 10 seconds the actor is still not initialized or the profile query has not resolved, treat the state as 'no profile' and allow the user to proceed to ProfileSetup rather than staying stuck indefinitely. Display a user-friendly message in the loading state such as 'Loading your profile…'.",
      "reqIds": [
        "REQ-34"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-app-tsx-from-scratch-with-simple-reliable-two-phase-routing-1-while-the-actor-is-null-or-the-profile-query-is-still-loading-show-a-full-screen-centered-loading-spinner-with-the-text-loading-your-profile-2-once-both-the-actor-is-initialized-and-the-profile-query-has-settled-route-to-loginpage-if-not-authenticated-profilesetup-if-authenticated-but-no-profile-exists-or-dashboard-if-authenticated-and-a-profile-exists-do-not-use-tri-state-enums-do-not-render-profilesetup-or-dashboard-until-the-profile-query-has-fully-resolved",
      "title": "Rewrite App.tsx from scratch with simple, reliable two-phase routing: (1) while the actor is null OR the profile query is still loading, show a full-screen centered loading spinner with the text 'Loading your profile…'; (2) once both the actor is initialized AND the profile query has settled, route to LoginPage if not authenticated, ProfileSetup if authenticated but no profile exists, or Dashboard if authenticated and a profile exists. Do not use tri-state enums. Do not render ProfileSetup or Dashboard until the profile query has fully resolved.",
      "reqIds": [
        "REQ-36"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-the-useprofile-hook-in-usequeries-ts-using-usequery-with-an-enabled-guard-the-backend-getprofile-call-must-only-fire-when-the-actor-is-confirmed-non-null-the-hook-must-return-isloading-true-while-the-actor-is-undefined-null-or-while-the-query-is-in-flight-and-only-return-a-settled-result-profile-or-null-after-the-async-call-has-fully-completed",
      "title": "Rewrite the useProfile hook in useQueries.ts using useQuery with an enabled guard: the backend getProfile call must only fire when the actor is confirmed non-null. The hook must return isLoading: true while the actor is undefined/null or while the query is in flight, and only return a settled result (profile or null) after the async call has fully completed.",
      "reqIds": [
        "REQ-37"
      ],
      "version": 1
    },
    {
      "id": "feature-rewrite-the-dashboard-page-frontend-src-pages-dashboard-tsx-as-a-single-unified-page-with-1-a-lifetime-daily-toggle-at-the-top-2-a-personal-stats-card-showing-the-logged-in-user-s-total-poops-and-total-wipes-lifetime-or-today-depending-on-toggle-3-a-log-a-poop-button-that-navigates-to-the-log-flow-4-a-leaderboard-standings-section-showing-all-users-ranked-by-total-poops-with-columns-for-display-name-emoji-total-poops-total-wipes-filtered-by-the-selected-toggle-mode-remove-all-efficient-wiper-references-remove-separate-leaderboard-and-alltimestandings-components-if-they-cause-complexity-inline-the-logic-cleanly",
      "title": "Rewrite the Dashboard page (frontend/src/pages/Dashboard.tsx) as a single unified page with: (1) a Lifetime/Daily toggle at the top, (2) a personal stats card showing the logged-in user's total poops and total wipes (lifetime or today depending on toggle), (3) a 'Log a Poop' button that navigates to the log flow, (4) a leaderboard/standings section showing all users ranked by total poops with columns for display name/emoji, total poops, total wipes — filtered by the selected toggle mode. Remove all Efficient Wiper references. Remove separate Leaderboard and AllTimeStandings components if they cause complexity; inline the logic cleanly.",
      "reqIds": [
        "REQ-38"
      ],
      "version": 1
    },
    {
      "id": "feature-keep-the-profilesetup-page-frontend-src-pages-profilesetup-tsx-intact-and-functional-allow-users-to-set-a-display-name-choose-from-preset-emojis-pick-a-color-and-background-preview-their-profile-and-submit-the-profile-to-the-backend-ensure-emojis-are-properly-centered-in-their-selection-boxes-on-mobile",
      "title": "Keep the ProfileSetup page (frontend/src/pages/ProfileSetup.tsx) intact and functional: allow users to set a display name, choose from preset emojis, pick a color and background, preview their profile, and submit the profile to the backend. Ensure emojis are properly centered in their selection boxes on mobile.",
      "reqIds": [
        "REQ-39"
      ],
      "version": 1
    },
    {
      "id": "feature-keep-the-logpoop-page-frontend-src-pages-logpoop-tsx-intact-a-simple-multi-step-flow-where-the-user-confirms-they-want-to-log-a-poop-enters-the-number-of-wipes-and-sees-a-success-screen-the-entry-is-submitted-to-the-backend-with-a-timestamp",
      "title": "Keep the LogPoop page (frontend/src/pages/LogPoop.tsx) intact: a simple multi-step flow where the user confirms they want to log a poop, enters the number of wipes, and sees a success screen. The entry is submitted to the backend with a timestamp.",
      "reqIds": [
        "REQ-40"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Rewrite the Motoko backend (backend/main.mo) from scratch with a clean, minimal implementation supporting: (1) user profile registration and retrieval keyed by principal (displayName, emoji, color, background), (2) logging a poop entry with wipe count and auto-timestamp, (3) retrieving all entries for the authenticated principal, (4) retrieving ranked stats for all users (total poops, total wipes) for both lifetime and daily (today) scopes. Remove any dead or unused functions.",
      "reqIds": [
        "REQ-35"
      ],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Keep the LoginPage (frontend/src/pages/LoginPage.tsx) intact with the Internet Identity login button and playful branding. No functional changes needed.",
      "reqIds": [
        "REQ-41"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Poop Tracker",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}